{% extends 'base.html' %}
{% load static humanize %}

{% block title %}County Dashboard - {{ PROJECT_NAME }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 class="mdc-typography--headline3">County Dashboard</h1>
    <p>Overview of all vehicles across all counties</p>
</div>

{% include 'dashboard/components/stats_cards.html' with stats=vehicle_stats %}

<div class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
        <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8">
            {% include 'dashboard/components/vehicle_map.html' %}
        </div>
        <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4">
            {% include 'dashboard/components/charts.html' %}
        </div>
    </div>
</div>

<div class="county-stats">
    <h2 class="mdc-typography--headline5">County Statistics</h2>
    <div class="mdc-data-table">
        <table class="mdc-data-table__table">
            <thead>
                <tr class="mdc-data-table__header-row">
                    <th class="mdc-data-table__header-cell">County</th>
                    <th class="mdc-data-table__header-cell">Total Vehicles</th>
                    <th class="mdc-data-table__header-cell">Active</th>
                    <th class="mdc-data-table__header-cell">Maintenance</th>
                </tr>
            </thead>
            <tbody class="mdc-data-table__content">
                {% for stat in county_stats %}
                <tr class="mdc-data-table__row">
                    <td class="mdc-data-table__cell">{{ stat.county }}</td>
                    <td class="mdc-data-table__cell">{{ stat.total }}</td>
                    <td class="mdc-data-table__cell">{{ stat.active }}</td>
                    <td class="mdc-data-table__cell">{{ stat.maintenance }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{% static 'js/map.js' %}"></script>
<script src="{% static 'js/charts.js' %}"></script>
<script>
    // Initialize map with vehicle locations
    const vehicleLocations = {{ vehicle_locations|safe }};
    initMap(vehicleLocations);
    
    // Initialize charts
    initCharts({
        vehicleStats: {{ vehicle_stats|safe }},
        maintenanceStats: {{ maintenance_stats|safe }},
        fuelStats: {{ fuel_stats|safe }}
    });
</script>
{% endblock %}
